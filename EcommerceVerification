// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract EcommerceVerification {
    struct GiaoDich {
        uint maDonHang;
        uint maSanPham;
        string tenSanPham;
        string danhMuc;
        string tenKhachHang;
        uint soLuong;
        uint tongTien;
        string nguonThanhToan;
        string maGiaoDich;
        string maVanDon;
        string trangThaiGiaoHang;
        uint thoiGianDatHang;
    }

    mapping(uint => GiaoDich) public giaoDichs;
    uint public soLuongGiaoDich = 0;

    event GiaoDichGhiNhan(
        uint maDonHang,
        uint maSanPham,
        string tenSanPham,
        string danhMuc,
        string tenKhachHang,
        uint soLuong,
        uint tongTien,
        string nguonThanhToan,
        string maGiaoDich,
        string maVanDon,
        string trangThaiGiaoHang,
        uint thoiGianDatHang
    );

    function ghiNhanGiaoDich(
        uint _maDonHang,
        uint _maSanPham,
        string memory _tenSanPham,
        string memory _danhMuc,
        string memory _tenKhachHang,
        uint _soLuong,
        uint _tongTien,
        string memory _nguonThanhToan,
        string memory _maGiaoDich,
        string memory _maVanDon,
        string memory _trangThaiGiaoHang,
        uint _thoiGianDatHang
    ) public {
        require(giaoDichs[_maDonHang].maDonHang == 0, "Ma don hang da ton tai");

        giaoDichs[_maDonHang] = GiaoDich(
            _maDonHang,
            _maSanPham,
            _tenSanPham,
            _danhMuc,
            _tenKhachHang,
            _soLuong,
            _tongTien,
            _nguonThanhToan,
            _maGiaoDich,
            _maVanDon,
            _trangThaiGiaoHang,
            _thoiGianDatHang
        );

        soLuongGiaoDich++;

        emit GiaoDichGhiNhan(
            _maDonHang,
            _maSanPham,
            _tenSanPham,
            _danhMuc,
            _tenKhachHang,
            _soLuong,
            _tongTien,
            _nguonThanhToan,
            _maGiaoDich,
            _maVanDon,
            _trangThaiGiaoHang,
            _thoiGianDatHang
        );
    }

    function chungThucGiaoDich(uint _maDonHang) public view returns (bool) {
        return giaoDichs[_maDonHang].maDonHang != 0;
    }

    function layThongTinGiaoDich(uint _maDonHang) public view returns (
        uint, uint, string memory, string memory, string memory, uint, uint, string memory, string memory, string memory, string memory, uint
    ) {
        require(giaoDichs[_maDonHang].maDonHang != 0, "Giao dich khong ton tai");
        GiaoDich memory gd = giaoDichs[_maDonHang];
        return (
            gd.maDonHang,
            gd.maSanPham,
            gd.tenSanPham,
            gd.danhMuc,
            gd.tenKhachHang,
            gd.soLuong,
            gd.tongTien,
            gd.nguonThanhToan,
            gd.maGiaoDich,
            gd.maVanDon,
            gd.trangThaiGiaoHang,
            gd.thoiGianDatHang
        );
    }
}
